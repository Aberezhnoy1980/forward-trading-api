# Backend api платформы для диверсификации депозита частных трейдеров и инвесторов [ForwardTrading](https://forwardtrading.ru/)
## MVP
1. Регистрация на сайте
   * Клиент заполняет форму на сайте (KYC/AML проверка).
   * Выбирает брокера из партнерского списка (IC Markets, RoboForex и др.).
   * Получает реферальную ссылку для открытия счета у брокера.
2. Открытие счета у брокера
    * Клиент переходит по ссылке на сайт брокера и открывает MT5-счет.
    * Сайт получает account_id клиента через API брокера (например, IC Markets предоставляет REST API для этого).
3. Подключение к MT5
   * Клиент скачивает MT5 и вводит логин/пароль от брокерского счета.
   * Ваш ИИ-модуль подключается к терминалу клиента через:
       * MQL5 Signals (для автоследования).
       * Собственный MT5-плагин (если нужен расширенный функционал).
4. Настройка автоследования
   * На сайте клиент:
       * Выбирает стратегию ИИ (консервативная/агрессивная).
       * Устанавливает параметры риска (макс. просадка, лотность).
       * Подтверждает подключение к вашему сигнальному счету.
5. Передача сигналов
   * ИИ-система анализирует рынок и генерирует сигналы.
   * Сигналы отправляются на MT5-сервер брокера через:
       * FIX-протокол (для низкой задержки).
       * MQL5 Cloud Network (через наш сигнальный счет).
6. Исполнение сделок
    * Брокерский сервер MT5 исполняет сделки на счете клиента:
        * Прямое копирование (Не РФ брокеры).
        * Одобрение через push-уведомление в приложении (если требуется подтверждение).
7. Синхронизация данных
    * Бэкенд получает данные о сделках клиента через:
        * Брокерское API (например, IC Markets Report API).
        * MT5 WebAPI.
8. Отчетность и аналитика
    * На сайте клиент видит:
        * Графики доходности.
        * Историю сделок.
        * Рекомендации ИИ по оптимизации выбранных параметров.

---

## Архитектура веб-приложения: Frontend + Backend + Database + Внешние API
Типичное RESTful API **веб-приложение с клиент-серверной архитектурой**, где:  
- **Frontend** (React + Nginx) – взаимодействует с Backend API и с пользователями.  
- **Backend** (API сервер: python + fastapi + sqlalchemy + Nginx) – обрабатывает запросы, работает с БД, аутентификацией.  
- **Databases** (PostgreSQL) – хранит данные пользователей, статистику, данные приложения.  
- **Внешние API** (OAuth, платежи, MT5 и др.) – интегрируются через Backend.  
1. Общая схема системы

![sys_arch](/docs/img/sys_arch_ext.png)

---

## Backend API Contracts (RESTful Best Practices)

### **1. Base URL**
```
https://ft-api.ru/api/v1
```

### **2. Authentication**
Все запросы, кроме `/auth/*`, требуют JWT-токена в заголовке:
```http
Authorization: Bearer {token}
```

---

### **3. Endpoints**

Документация:

[openAPI (Swagger)](http://ft-api.ru/api/docs)

[Redocly](http://ft-api.ru/api/redoc)

#### **A. Authentication**
| Метод | Путь                     | Описание                          | Требует авторизации | Пример запроса (Request)                                                                 | Пример ответа (Response)                                                                 |
|-------|--------------------------|-----------------------------------|---------------------|------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| POST  | `/auth/login`            | Аутентификация пользователя       | Нет                 | ```json {"email": "user@example.com", "password": "password123"}```                      | ```json {"user": {"id": "uuid", "name": "John", "role": "user"}, "token": "jwt.token"}```|
| POST  | `/auth/register`         | Регистрация нового пользователя   | Нет                 | ```json {"name": "John", "email": "user@example.com", "password": "password123"}```      | ```json {"id": "uuid", "name": "John", "email": "user@example.com", "role": "user"}```   |

#### **B. Users**
| Метод | Путь                     | Описание                          | Требует авторизации | Пример запроса (Request)                                       | Пример ответа (Response)                                                                 |
|-------|--------------------------|-----------------------------------|---------------------|----------------------------------------------------------------|------------------------------------------------------------------------------------------|
| GET   | `/users/{user_id}`       | Получить профиль пользователя     | Да (только свой)    | -                                                              | ```json {"id": "uuid", "name": "John", "email": "user@example.com", "role": "user"}```   |
| PATCH | `/users/{user_id}/account`| Обновить номер счёта             | Да                  | ```json {"account_number": "12345", "account_type": "demo"}``` | ```json {"message": "Account updated"}```                                               |
| PATCH | `/users/{user_id}/account`| Включение/выключение авто-трекинга. | Да                  | ```json {"autofollow": "true"}```                              | ```json {"message": "Account updated"}```                                               |
#### **C. Trading**
| Метод | Путь                     | Описание                          | Требует авторизации | Пример запроса (Request)                                                                 | Пример ответа (Response)                                                                 |
|-------|--------------------------|-----------------------------------|---------------------|------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------|
| POST  | `/trading/positions`     | Проксирование данных МТ5          | Да                  | ```form-data login=123&server=Live&...```                                               | ```json {"message": "Data saved"}```                                                    |
| GET   | `/trading/advisor`       | Скачать советник                  | Да                  | -                                                                                        | `Binary file (EA)`                                                                      |

---
